# â˜ï¸ é›²ç«¯å‰ªè²¼ç°¿ (Cloud Clipboard)
é€™æ˜¯ä¸€å€‹ä½¿ç”¨ React å’Œ Firebase å»ºç«‹çš„é›²ç«¯å‰ªè²¼ç°¿æ‡‰ç”¨ç¨‹å¼ã€‚ä½¿ç”¨è€…å¯ä»¥è¼•é¬†åœ°åœ¨å¤šå€‹è£ç½®é–“åŒæ­¥æ–‡å­—ã€åœ–ç‰‡å’Œæª”æ¡ˆï¼Œå¯¦ç¾ç„¡ç¸«çš„è·¨å¹³å°å·¥ä½œæµç¨‹ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½
* è·¨è£ç½®åŒæ­¥ï¼šåœ¨ä»»ä½•è£ç½®ç™»å…¥ï¼Œå³å¯å­˜å–æ‚¨æ‰€æœ‰çš„å‰ªè²¼é …ç›®ã€‚
* å¤šç¨®é¡å‹æ”¯æ´ï¼šè¼•é¬†æ–°å¢æ–‡å­—ã€ä¸Šå‚³åœ–ç‰‡ã€å½±ç‰‡æˆ–ä»»ä½•å…¶ä»–æª”æ¡ˆã€‚
* å³æ™‚æ›´æ–°ï¼šæ‰€æœ‰å…§å®¹é€é Firebase Firestore é€²è¡Œå³æ™‚åŒæ­¥ã€‚
* åœ–ç‰‡é è¦½ï¼šé»æ“ŠæŒ‰éˆ•å³å¯é è¦½åœ–ç‰‡ã€‚
* æª”æ¡ˆä¸‹è¼‰ï¼šä¸€éµä¸‹è¼‰æ‚¨å„²å­˜çš„ä»»ä½•æª”æ¡ˆã€‚
* é€²åº¦é¡¯ç¤ºï¼šä¸Šå‚³æª”æ¡ˆæ™‚ï¼Œæœƒé¡¯ç¤ºå³æ™‚é€²åº¦æ¢ã€‚
* å®‰å…¨é©—è­‰ï¼šä½¿ç”¨ Firebase Authentication é€²è¡Œå®‰å…¨çš„é›»å­éƒµä»¶/å¯†ç¢¼è¨»å†Šå’Œç™»å…¥ã€‚
* é‡˜é¸åŠŸèƒ½ï¼šå°‡é‡è¦çš„é …ç›®é‡˜é¸åœ¨æœ€ä¸Šæ–¹ï¼Œæ–¹ä¾¿å¿«é€Ÿå­˜å–ã€‚
* å¿«é€Ÿæœå°‹ï¼šå³æ™‚ç¯©é¸ï¼Œè¿…é€Ÿæ‰¾åˆ°æ‚¨éœ€è¦çš„å…§å®¹ã€‚
* å¸³è™Ÿè¨­å®šï¼šé‡è¨­å¯†ç¢¼ã€åŠ å…¥ Passkey æˆ–åˆªé™¤å¸³è™Ÿã€‚

## ğŸ› ï¸ ä½¿ç”¨çš„æŠ€è¡“
### å‰ç«¯ï¼š
* React - ç”¨æ–¼å»ºç«‹ä½¿ç”¨è€…ä»‹é¢çš„ JavaScript å‡½å¼åº«ã€‚
* Vite - æ–°ä¸€ä»£çš„å‰ç«¯é–‹ç™¼èˆ‡å»ºç½®å·¥å…·ã€‚
* Tailwind CSS - ä¸€å€‹åŠŸèƒ½å„ªå…ˆçš„ CSS æ¡†æ¶ï¼Œç”¨æ–¼å¿«é€Ÿè¨­è¨ˆä»‹é¢ã€‚

### å¾Œç«¯èˆ‡è³‡æ–™åº« (Firebase)ï¼š
* Firebase Authentication - è™•ç†ä½¿ç”¨è€…è¨»å†Šã€ç™»å…¥å’Œé©—è­‰ã€‚
* Cloud Firestore Database - ç”¨æ–¼å³æ™‚å„²å­˜å’ŒåŒæ­¥æ–‡å­—è³‡æ–™ã€‚
* Cloud Storage for Firebase - ç”¨æ–¼å„²å­˜ä½¿ç”¨è€…ä¸Šå‚³çš„æª”æ¡ˆï¼ˆåœ–ç‰‡ã€å½±ç‰‡ç­‰ï¼‰ã€‚
* Firebase Hosting - ç”¨æ–¼éƒ¨ç½²å’Œè¨—ç®¡ç¶²ç«™ã€‚

### è‡ªå‹•åŒ–éƒ¨ç½² (CI/CD)ï¼š
GitHub Actions - è‡ªå‹•åŒ–æ‰“åŒ…å°ˆæ¡ˆä¸¦éƒ¨ç½²åˆ° Firebase Hostingã€‚

## ğŸš€ å¦‚ä½•åœ¨æœ¬æ©ŸåŸ·è¡Œ
å¦‚æœæ‚¨æƒ³åœ¨æœ¬æ©Ÿç’°å¢ƒåŸ·è¡Œæ­¤å°ˆæ¡ˆï¼Œè«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿæ“ä½œï¼š
### 1. å‰ç½®éœ€æ±‚
   * å·²å®‰è£ Node.js (å»ºè­°ç‰ˆæœ¬ v16 æˆ–ä»¥ä¸Š)ã€‚
   * æ–°å»ºä¸€å€‹ Firebase å°ˆæ¡ˆã€‚
### 2. è¤‡è£½ä¸¦å®‰è£å°ˆæ¡ˆ

```sh
# è¤‡è£½å„²å­˜åº«
git clone https://github.com/alvin000009238/cloud-clipboard-app.git
```
```sh
# é€²å…¥å°ˆæ¡ˆè³‡æ–™å¤¾
cd cloud-clipboard-app
```
```sh
# å®‰è£æ‰€æœ‰ä¾è³´å¥—ä»¶
npm install
```
### 3. è¨­å®š Firebase é‡‘é‘°
   * åœ¨æ‚¨çš„ Firebase å°ˆæ¡ˆè¨­å®šä¸­ï¼Œæ‰¾åˆ°æ‚¨çš„ç¶²é æ‡‰ç”¨ç¨‹å¼è¨­å®šé‡‘é‘° (firebaseConfig)ã€‚åœ¨å°ˆæ¡ˆçš„æ ¹ç›®éŒ„ä¸‹ï¼Œå»ºç«‹ä¸€å€‹åç‚º `.env.local` çš„æª”æ¡ˆã€‚å°‡æ‚¨çš„é‡‘é‘°ä¾ç…§ä»¥ä¸‹æ ¼å¼å¡«å…¥æª”æ¡ˆä¸­ï¼š
```sh
VITE_FIREBASE_API_KEY="YOUR_API_KEY"
VITE_FIREBASE_AUTH_DOMAIN="YOUR_AUTH_DOMAIN"
VITE_FIREBASE_PROJECT_ID="YOUR_PROJECT_ID"
VITE_FIREBASE_STORAGE_BUCKET="YOUR_STORAGE_BUCKET"
VITE_FIREBASE_MESSAGING_SENDER_ID="YOUR_MESSAGING_SENDER_ID"
VITE_FIREBASE_APP_ID="YOUR_APP_ID"
```
### 4. è¨­å®š Firebase å®‰å…¨è¦å‰‡
   * è«‹å‹™å¿…åœ¨æ‚¨çš„ Firebase æ§åˆ¶å°ä¸­ï¼Œç‚º Firestore Database å’Œ Storage è¨­å®šæ­£ç¢ºçš„å®‰å…¨è¦å‰‡ï¼Œä»¥ç¢ºä¿åªæœ‰å·²ç™»å…¥çš„ä½¿ç”¨è€…å¯ä»¥å­˜å–è‡ªå·±çš„è³‡æ–™ã€‚
```sh
// Firestore Database è¦å‰‡
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /artifacts/{appId}/users/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```
```sh
// Storage è¦å‰‡
rules_version = '2';
service firebase.storage {
	match /b/{bucket}/o {
		match /artifacts/{appId}/users/{userId}/{allPaths=**} {
			allow read, write, delete: if request.auth != null && request.auth.uid == userId;
		}
	}
}
```

### 5. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
```sh
npm run dev
```

æ‡‰ç”¨ç¨‹å¼å°‡æœƒåœ¨ `http://localhost:5173` ä¸ŠåŸ·è¡Œã€‚


## ğŸ” è¨­å®š Passkey èˆ‡ Cloud Functions
### 1. å®‰è£å‰ç«¯å¥—ä»¶
```sh
npm install @simplewebauthn/browser
```


### 2. è¨­å®š Functions èˆ‡ Firebase
å°ˆæ¡ˆå·²æä¾›å®Œæˆçš„ Cloud Functions å¯¦ä½œï¼ˆ`functions/index.js`ï¼‰ï¼ŒåŒ…å«ï¼š

* RP IDï¼šæ­£å¼ç«™å›ºå®šç‚º `cloud.20090408.xyz`ï¼Œæœ¬æ©Ÿè‡ªå‹•åˆ‡æ›ç‚º `localhost`ã€‚
* CORSï¼šå…è¨± `https://cloud.20090408.xyz` èˆ‡ `http://localhost:5173`ï¼Œä¸¦å•Ÿç”¨ `credentials`ã€‚
* Base64URLï¼šæ‰€æœ‰ WebAuthn æ¬„ä½ï¼ˆcredentialIDã€publicKeyã€signatureâ€¦ï¼‰ä»¥ Base64URL å­˜å– Firestoreã€‚
* æŒ‘æˆ°ç®¡ç†ï¼šè¨»å†Šèˆ‡ç™»å…¥åˆ†åˆ¥å„²å­˜æŒ‘æˆ°å€¼ï¼Œé©—è­‰æˆåŠŸå¾Œå³æ™‚æ¸…é™¤ï¼Œé¿å…é‡è¤‡ä½¿ç”¨ã€‚
* è‡ªè¨‚å›æ‡‰ï¼šçµ±ä¸€å›å‚³ `{ ok, code, message }` ä¾¿æ–¼å‰ç«¯é¡¯ç¤ºè©³ç´°éŒ¯èª¤ã€‚

éƒ¨ç½²å‰è«‹å…ˆå®‰è£å‡½å¼ä¾è³´ä¸¦è¨­å®š Firebase å°ˆæ¡ˆï¼š

```sh
npm --prefix functions install
firebase deploy --only functions
```

å¦‚éœ€æŒ‡å®š Functions å€åŸŸï¼Œå¯åœ¨ `.env.local` åŠ å…¥ï¼š

```sh
VITE_FIREBASE_FUNCTIONS_REGION="us-central1"
```

### 3. å‰ç«¯å‘¼å«æµç¨‹
* è¨»å†Šï¼šä½¿ç”¨è€…é»æ“Šã€ŒåŠ å…¥ Passkeyã€â†’ `GET /regOptions` â†’ `startRegistration` â†’ `POST /regVerify`ã€‚
* ç™»å…¥ï¼šæŒ‰ä¸‹ã€Œä½¿ç”¨ Passkey ç™»å…¥ã€â†’ `GET /authOptions?email=...` â†’ `startAuthentication` â†’ `POST /authVerify` â†’ ä»¥ `customToken` å‘¼å« `signInWithCustomToken`ã€‚

å‰ç«¯ `fetch` çš†è¨­å®š `credentials: 'include'`ï¼Œå¦‚éœ€ä½¿ç”¨ Firebase Session Cookie å¯ç›´æ¥å»¶ä¼¸ï¼›æ‰€æœ‰éŒ¯èª¤ç¢¼æœƒé€é UI å‘ˆç¾ã€‚

### 4. æ¸¬è©¦èˆ‡é©—è­‰
1. æœ¬æ©Ÿæ¸¬è©¦ï¼šä»¥ `npm run dev` åœ¨ `http://localhost:5173` æ“ä½œï¼Œç¢ºèª Functions ç«¯ `rpID` è½‰ç‚º `localhost`ã€‚
2. æ­£å¼æ¸¬è©¦ï¼šæ–¼ `https://cloud.20090408.xyz` é‡æ–°è¨»å†Šèˆ‡ç™»å…¥ï¼Œç¢ºèª Firestore `users/{uid}/credentials/{credId}` å¯«å…¥æˆåŠŸä¸” `authVerify` å›å‚³ `customToken`ã€‚
3. è‹¥é‡éŒ¯èª¤ï¼Œå¯æŸ¥çœ‹ Cloud Functions Logs ä»¥ç¢ºèª `origin`ã€`rpID` èˆ‡ `challenge` ç‹€æ…‹ã€‚

æ›´å¤šç´°ç¯€è«‹åƒè€ƒ [SimpleWebAuthn æ–‡ä»¶](https://simplewebauthn.dev/)ã€‚


